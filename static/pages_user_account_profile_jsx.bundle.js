"use strict";
/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackChunk"] = self["webpackChunk"] || []).push([["pages_user_account_profile_jsx"],{

/***/ "./components/notification.js":
/*!************************************!*\
  !*** ./components/notification.js ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   FailNotify: () => (/* binding */ FailNotify),\n/* harmony export */   SuccessNotify: () => (/* binding */ SuccessNotify)\n/* harmony export */ });\n/* harmony import */ var sweetalert2__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! sweetalert2 */ \"./node_modules/.pnpm/sweetalert2@11.7.27/node_modules/sweetalert2/dist/sweetalert2.all.js\");\n/* harmony import */ var sweetalert2__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(sweetalert2__WEBPACK_IMPORTED_MODULE_0__);\n\n\nconst SuccessNotify = (title) =>\n  sweetalert2__WEBPACK_IMPORTED_MODULE_0___default().fire({\n    icon: \"success\",\n    title: title,\n    timer: 1500,\n    showConfirmButton: false,\n  });\n\nconst FailNotify = (title) =>\n  sweetalert2__WEBPACK_IMPORTED_MODULE_0___default().fire({\n    icon: \"error\",\n    title: title,\n    timer: 1500,\n    showConfirmButton: false,\n  });\n\n\n//# sourceURL=webpack:///./components/notification.js?");

/***/ }),

/***/ "./pages/user/account/profile.jsx":
/*!****************************************!*\
  !*** ./pages/user/account/profile.jsx ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Component: () => (/* binding */ Component)\n/* harmony export */ });\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/.pnpm/react@18.2.0/node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _components_notification_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/components/notification.js */ \"./components/notification.js\");\n/* harmony import */ var react_router_dom__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! react-router-dom */ \"./node_modules/.pnpm/react-router@6.15.0_react@18.2.0/node_modules/react-router/dist/index.js\");\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t[\"return\"] && (u = t[\"return\"](), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\n\n\nvar UserInput = function UserInput(_ref) {\n  var type = _ref.type,\n    orgin = _ref.orgin,\n    change = _ref.change,\n    title = _ref.title;\n  var _React$useState = react__WEBPACK_IMPORTED_MODULE_0___default().useState(\"\"),\n    _React$useState2 = _slicedToArray(_React$useState, 2),\n    val = _React$useState2[0],\n    setval = _React$useState2[1];\n  var handle_number_input = function handle_number_input(e) {\n    setval(e.target.value.replace(/[^0-9]/, \"\"));\n    change(e.target.name, e.target.value.replace(/[^0-9]/, \"\"));\n  };\n  var handle_text_input = function handle_text_input(e) {\n    setval(e.target.value);\n    change(e.target.name, e.target.value);\n  };\n  react__WEBPACK_IMPORTED_MODULE_0___default().useEffect(function () {\n    setval(orgin);\n  }, [orgin]);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"form_line\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    className: \"text-gray-500\"\n  }, title), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"input\", {\n    className: \"px-2 py-1 border-2 border-gray-300 rounded-lg w-full\",\n    name: title,\n    type: type,\n    value: val,\n    onInput: title !== \"phone\" ? handle_text_input : handle_number_input\n  }));\n};\nvar UserImgInput = function UserImgInput(_ref2) {\n  var orgin = _ref2.orgin;\n  var _React$useState3 = react__WEBPACK_IMPORTED_MODULE_0___default().useState(\"\"),\n    _React$useState4 = _slicedToArray(_React$useState3, 2),\n    img = _React$useState4[0],\n    setImg = _React$useState4[1];\n  var _React$useState5 = react__WEBPACK_IMPORTED_MODULE_0___default().useState(false),\n    _React$useState6 = _slicedToArray(_React$useState5, 2),\n    img_change = _React$useState6[0],\n    setChange = _React$useState6[1];\n  var triggerImageChange = function triggerImageChange() {\n    var file_input = document.createElement(\"input\");\n    file_input.type = \"file\";\n    file_input.accept = \"image/*\";\n    file_input.onchange = function (e) {\n      var image = e.target.files[0];\n      var reader = new FileReader();\n      reader.readAsDataURL(image);\n      reader.onload = function (readerEvent) {\n        var content = readerEvent.target.result;\n        console.log(content);\n        setImg(content);\n      };\n    };\n    file_input.click();\n  };\n  var triggerImageUpload = function triggerImageUpload() {\n    fetch(\"/api/account/ChangeProfile\", {\n      body: JSON.stringify({\n        photo: img\n      }),\n      headers: {\n        \"content-type\": \"application/json\"\n      },\n      method: \"POST\"\n    }).then(function (res) {\n      if (res.status === 200) {\n        return res.json();\n      } else {\n        (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"上傳圖片出現錯誤\");\n      }\n    }).then(function (data) {\n      if (data.cause !== 0) {\n        (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"上傳圖片出現錯誤\");\n      } else {\n        (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.SuccessNotify)(\"圖片上傳成功\").then(function () {\n          return location.href = location.href;\n        });\n      }\n    });\n  };\n  react__WEBPACK_IMPORTED_MODULE_0___default().useEffect(function () {\n    if (img === \"\") {\n      setImg(orgin);\n    }\n    if (orgin !== img) {\n      setChange(true);\n    } else {\n      setChange(false);\n    }\n  }, [orgin, img]);\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"flex flex-col gap-3 max-w-[150px] mx-auto\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"img\", {\n    className: \"w-36 h-36 rounded-full object-cover bg-white border-[1px] \",\n    src: img\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"flex justify-center\"\n  }, img_change ? /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement((react__WEBPACK_IMPORTED_MODULE_0___default().Fragment), null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"text-white bg-orange-500 rounded-lg py-1 px-2 block mx-auto\",\n    onClick: triggerImageUpload\n  }, \"\\u78BA\\u8A8D\\u4FEE\\u6539\"), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"text-gray-400 bg-white border-gray-400 border-2  box-border rounded-lg py-1 px-2 block mx-auto\",\n    onClick: function onClick() {\n      return setImg(orgin);\n    }\n  }, \"\\u53D6\\u6D88\")) : /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", null, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"text-white bg-orange-500 rounded-lg py-1 px-2 block mx-auto\",\n    onClick: triggerImageChange\n  }, \"\\u66F4\\u6539\\u7167\\u7247\"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"p\", {\n    className: \"text-sm text-gray-500 text-center\"\n  }, \"\\u6211\\u53EA\\u5403png :P\"));\n};\nvar Component = function Component() {\n  var _React$useState7 = react__WEBPACK_IMPORTED_MODULE_0___default().useState({\n      name: \"\",\n      email: \"\",\n      phone: \"\",\n      photo: \"\",\n      file_path: \"\"\n    }),\n    _React$useState8 = _slicedToArray(_React$useState7, 2),\n    userinfo = _React$useState8[0],\n    setInfo = _React$useState8[1];\n  var navigate = (0,react_router_dom__WEBPACK_IMPORTED_MODULE_2__.useNavigate)();\n  var _React$useState9 = react__WEBPACK_IMPORTED_MODULE_0___default().useState(\"\"),\n    _React$useState10 = _slicedToArray(_React$useState9, 2),\n    user_img = _React$useState10[0],\n    setImg = _React$useState10[1];\n  var _React$useState11 = react__WEBPACK_IMPORTED_MODULE_0___default().useState({}),\n    _React$useState12 = _slicedToArray(_React$useState11, 2),\n    change = _React$useState12[0],\n    setChange = _React$useState12[1];\n  react__WEBPACK_IMPORTED_MODULE_0___default().useEffect(function () {\n    getInfo();\n  }, []);\n  var getInfo = function getInfo() {\n    fetch(\"/api/account/GetUserDetail\", {\n      body: JSON.stringify({\n        require: [\"photo\", \"name\", \"email\", \"phone\", \"file_path\"]\n      }),\n      method: \"POST\",\n      headers: {\n        \"content-type\": \"application/json\"\n      }\n    }).then(function (response) {\n      if (response.status === 200) {\n        return response.json();\n      } else {\n        (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"請先登入\").then(function () {\n          return navigate(\"/auth/login\");\n        });\n      }\n    }).then(function (data) {\n      if (data.cause === 0) {\n        setInfo({\n          name: data.name,\n          email: data.email,\n          phone: data.phone,\n          photo: data.file_path\n        });\n        setImg(data.file_path == null ? \"/static/img/logo1.png\" : \"\".concat(data.file_path.slice(1)));\n      } else {\n        (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"請先登入\").then(function () {\n          return navigate(\"/auth/login\");\n        });\n      }\n    });\n  };\n  var handle_change = function handle_change(name, val) {\n    change[name] = val;\n    // console.log(name, change)\n    setChange(change);\n  };\n  var handle_upload = function handle_upload() {\n    var need2upload = false;\n    for (var _i = 0, _Object$entries = Object.entries(change); _i < _Object$entries.length; _i++) {\n      var i = _Object$entries[_i];\n      if (userinfo[i[0]] !== i[1]) {\n        need2upload = true;\n      }\n    }\n    if (need2upload) {\n      fetch(\"/api/account/ChangeProfile\", {\n        body: JSON.stringify(change),\n        headers: {\n          \"content-type\": \"application/json\"\n        },\n        method: \"POST\"\n      }).then(function (res) {\n        if (res.status === 200) {\n          return res.json();\n        } else {\n          (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"資訊更新出現錯誤\").then(function () {\n            getInfo();\n          });\n        }\n      }).then(function (data) {\n        console.log(data);\n        if (data.cause !== 0) {\n          (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.FailNotify)(\"資訊更新出現錯誤\").then(function () {\n            getInfo();\n          });\n        } else {\n          (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.SuccessNotify)(\"資料更新成功\").then(function () {\n            getInfo();\n          });\n        }\n      });\n    } else {\n      (0,_components_notification_js__WEBPACK_IMPORTED_MODULE_1__.SuccessNotify)(\"資料並未變動\");\n    }\n  };\n  var name2type = {\n    name: \"text\",\n    email: \"email\",\n    phone: \"text\"\n  };\n  return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"bg-white w-[800px] mx-auto p-3 rounded-lg shadow-sm h-fit\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"mb-2\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"h1\", {\n    className: \"text-2xl font-bold\"\n  }, \"\\u5728\\u6B64\\u4FEE\\u6539\\u4F60\\u7684\\u500B\\u4EBA\\u8CC7\\u6599\")), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"w-full h-[1px] bg-gray-300 my-3\"\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"flex gap-3\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \" grow flex flex-col gap-3\"\n  }, Object.entries(userinfo).map(function (i) {\n    // console.log(i[1])\n    if (i[0] !== \"photo\") {\n      return /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(UserInput, {\n        orgin: i[1],\n        type: name2type[i[0]],\n        title: i[0],\n        change: handle_change\n      });\n    }\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"flex\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"button\", {\n    className: \"text-white bg-orange-500 rounded-lg py-1 px-2 block mx-auto\",\n    onClick: handle_upload\n  }, \"\\u78BA\\u8A8D\\u8B8A\\u66F4\"))), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"w-[1px] bg-gray-300\"\n  }), /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(\"div\", {\n    className: \"w-48\"\n  }, /*#__PURE__*/react__WEBPACK_IMPORTED_MODULE_0___default().createElement(UserImgInput, {\n    orgin: user_img\n  }))));\n};\n\n//# sourceURL=webpack:///./pages/user/account/profile.jsx?");

/***/ })

}]);